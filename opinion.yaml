---
id: '58e5596a13d0cc000e88a95d'
name: 'Qubeship basic  opinion (build only)'
description: 'Qubeship Basic Opinion'
visibility: 'public'

variables:
  - name: BASE_URL_E2E
    optional: true
  - name: CONTAINER_NAME
    optional: false
    value: $(qubeship:project::containerName)
  - name: TWISTLOCK_URL
    optional: true
    value: $(qubeship:endpoints:[name.eq('TwistlockConsole')]:endPoint)
  - name: TWISTLOCK_CREDENTIALS
    optional: true
    value: $(qubeship:secret:[name.eq('TwistlockConsole')])
isDefault: 'True'
graml:
  version: 1.0
graph:
  build:
    has:
      - compile
      - unittest
      - static_code_analysis
    on_error:
      - notify
    next: bake
  bake:
    has:
      - docker_build
      - scan
    on_error:
      - notify
# below is the default implementation
vertices:
  build:
    skippable: true
  docker_build:
    action:
      - "docker build -t $1 -f $2 ."
    args:
      - $(CONTAINER_NAME)
      - Dockerfile-busybox
    execute_outside_toolchain: true
  scan:
    action:
      - "echo $1"
    args:
      - $(TWISTLOCK_URL)
    execute_outside_toolchain: true
